# Participation Manager Bot 取扱説明書

このシステムは、DiscordサーバーとYouTube Liveの参加者（参加希望者）を一元管理し、公平にセッション（対戦・協力プレイなど）のメンバーを選出するためのツールです。

## 1. クイックスタート

### Botの起動
1. ターミナルで `node index.js` を実行してBotを起動します。
2. Discordで `!panel` と入力すると、操作パネルが表示されます。

### 募集の開始
1. Discordで `!recruit [募集内容]` を入力します。
   - 例: `!recruit ランクマ募集 @3`
2. 募集内容が書かれたパネルが表示されます。
3. 参加者はパネルの「参加」ボタンを押すだけで待機リストに登録されます。

---

## 2. Discord Botの機能

### 操作パネル (GUI)
コマンドを入力しなくても、ボタン操作で参加・辞退が可能です。

- **[参加] ボタン**: 待機リストに名前を登録します。
- **[辞退] ボタン**: 待機リストから名前を削除します。
- **[更新] ボタン**: 待機人数やセッション状況を最新の情報に更新します。

### コマンド一覧
チャット欄に入力して使用します。

| コマンド | 説明 |
| :--- | :--- |
| `!panel` | 操作パネルを表示します。 |
| `!recruit [内容]` | 募集内容を設定してパネルを表示します。 |
| `!join [名前]` | 待機リストに参加します（名前は省略可）。 |
| `!leave` | 待機リストから抜けます。 |
| `!list` | 現在の待機リストを表示します。 |
| `!session` | 現在プレイ中のメンバーを表示します。 |
| `!next [人数]` | 次のセッションのメンバーを選出します（デフォルト1人）。 |
| `!finish` | 現在のセッションを終了し、履歴に記録します。 |
| `!reset` | 待機リストとセッションをリセットします。 |

### 自然言語対応
会話の中で以下のキーワードが含まれると、自動的に反応します。
- **「参加希望」**: 待機リストに追加されます。
- **「参加辞退」**: 待機リストから削除されます。

---

## 3. Webアプリとの連携

Webアプリ（`index.html`）を使うと、より高度な管理が可能です。

### 連携手順
1. Botを起動しておきます（`node index.js`）。
2. Webアプリを開き、左下の **"Bot Integration"** パネルを探します。
3. **"Enable Sync"** スイッチをONにします。
4. "Connected" と表示されれば連携完了です。

### できること
- **YouTube Live連携**: YouTubeのコメントから「参加希望」を拾い、自動的にBotの待機リストに追加します。
- **視覚的な管理**: ドラッグ＆ドロップでの並べ替えや、タイマー機能などが使えます。
- **同期**: Webアプリでの操作（セッション開始など）は、即座にDiscord Botにも反映されます。

---

## 4. トラブルシューティング

### Q. パネルのボタンが反応しない / 「インタラクションに失敗しました」と出る
**A.** Botが再起動された可能性があります。もう一度 `!panel` または `!recruit` を実行して、新しいパネルを出してください。

### Q. Botが2回返事をする
**A.** Botのプログラムが二重に起動している可能性があります。ターミナルで一度 `Ctrl+C` を押して停止させるか、タスクマネージャー等で `node` プロセスを終了させてから、再度起動してください。

### Q. Webアプリと同期しない
**A.** Botが起動しているか（`http://localhost:3000` でAPIが動いているか）確認してください。また、Webアプリの "Bot API URL" 設定が正しいか確認してください（デフォルトは `http://localhost:3000`）。
